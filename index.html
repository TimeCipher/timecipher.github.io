<!-- <canvas width="1500" height="2000" id="game"></canvas> -->
<title id="Page Title">AO4</title>
<style>
    body {
      width: 750px;
      margin: auto;
      font-family:'Helvetica';
    }
</style>
<head>
    <title id="PageTitle">AO4</title>
</head>
<body>
    <h2 id="PageTag">
        System: Error
    </h2>
    <p id="SearchingTxt">Searching: Local Files</p>
    <textarea id="name"></textarea>
    <p></p>
    <button id="ShowFicsButton" type="button" onclick="ToggleShowFics();">Show Fics</button>
    <p id="FicsList"></p>
    <h3 id="Title">Title: Unknown</h3>
    <div>
        <p id="Content" style="font-family:'Helvetica'">Unknown</p>
    </div>
</body>
<script>
    //let Socket = new WebSocket('ws://51.210.139.126:1011/');
    let Socket = new WebSocket('ws://localhost:1011/');

    let CurrentFic = '';
    let FicData = {
        FicTitle : 'Empty',
        Content : 'Empty',
    };

    document.getElementById('Title').innerText = ''; 
    document.getElementById('Content').innerText = ''; 

    function NoteWorthyUrls(){
        //https://archiveofourown.org/tags/Gravity%20Falls/works
        //https://archiveofourown.org/works/39488682
        //https://archiveofourown.org/works/36270376/chapters/90417781
        //https://archiveofourown.org/tags/Bill%20Cipher%20*a*%20Dipper%20Pines/works
        //https://archiveofourown.org/works/30299901/chapters/74681877
        //https://archiveofourown.org/works/34674964
        //https://archiveofourown.org/works/23413513/chapters/56113738
        //https://archiveofourown.org/works/38391733/chapters/95939920
        //https://archiveofourown.org/works/38469328/chapters/96145120
        //https://archiveofourown.org/works/34185613/chapters/85062328
        //https://archiveofourown.org/works/36448594/chapters/90883834
        //https://archiveofourown.org/works/6996595/chapters/15938677
        //https://www.wattpad.com/story/144395008-under-the-moonlight
    }

    let FicListVisible = false;
    function ToggleShowFics() {
        if (FicListVisible == false) {
            FicListVisible = true;
        } else {
            FicListVisible = false;
        };
    }

    Socket.onmessage = ({data}) => {
        //Data = JSON.parse(data);
        //console.log(data);
        //FicData['FicTitle'] = Data['Title'];
        //FicData['Content'] = Data['Content'];
        var SplKey = '$[(*-%=%-*)]$';
        var SplData = data.split(SplKey);
        if (SplData[0] == 'Title') {
            FicData['FicTitle'] = SplData[1];
        } else if (SplData[0] == 'Content') {
            FicData['Content'] = SplData[1];
        };
    };

    let Panic = false;
    document.onkeydown = e => {
        switch (e.keyCode) {
            case 81:
                if (Panic == false) {
                    Panic = true;
                } else {
                    Panic = false;
                };
            break;
            case 82:
                let StrRevA = FicData['Content'].split('');
                let StrRevB = StrRevA.reverse();
                let StrRevC = StrRevB.join('');
                FicData['Content'] = StrRevC;
            break;
        };
    };

    setInterval(async () => {
        if (Panic == true) {
            document.getElementById('PageTag').innerText = '';
            document.getElementById('SearchingTxt').innerText = '';
        } else {
            document.getElementById('PageTag').innerText = '[][]----------------[][]|       AO4            |[][]----------------[][]';
            document.getElementById('SearchingTxt').innerText = 'Searching: Local Files';
        };

        if (Panic == true) {
            document.getElementById('ShowFicsButton').innerText = '';
            document.getElementById('FicsList').innerText = ``;
        } else {
            if (FicListVisible == true) {
                document.getElementById('FicsList').innerText = `
                Crown
                RedWhiteBlue
                Kingdom
                Moonlight
                Assistant
                WhoAreYou
                TheTriangleClub
                LastTime
                LoveBeforeYou
                BladesShield
                WhatHaveYouDone
                GravityClub
                LookingFor
                `;
                document.getElementById('ShowFicsButton').innerText = 'Hide Fics';
            } else {
                document.getElementById('ShowFicsButton').innerText = 'Show Fics';
                document.getElementById('FicsList').innerText = ``;
            };
        };

        if (document.getElementById('name').value.endsWith('\n')) {
            CurrentFic = document.getElementById('name').value;
            document.getElementById('name').value = '';
            CurrentFic = CurrentFic.replace('\n','');
            //FicData['Content'] = readTextFile("file://./"+CurrentFic+"/"+"Content.txt");
            //FicData['FicTitle'] = Fics[CurrentFic]['Title']
            //FicData['Content'] = Fics[CurrentFic]['Content']
            //console.log(':-'+CurrentFic+'-:')
            Socket.send('GetFic '+CurrentFic);
        };

        if (CurrentFic != '') {
            if (Panic == false) {
                    document.getElementById('Title').innerText = 'Title: '+FicData['FicTitle']; 
                    document.getElementById('Content').innerText = FicData['Content']; 
            } else {
                document.getElementById('Title').innerText = '';
                document.getElementById('Content').innerText = ''; 
            };
        };
    }, 1000);
</script>
